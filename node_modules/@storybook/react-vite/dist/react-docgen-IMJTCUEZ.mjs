import"./chunk-R4NKYYJA.mjs";import path from"path";import{createFilter}from"@rollup/pluginutils";import{parse,handlers as docgenHandlers,resolver as docgenResolver,importers as docgenImporters}from"react-docgen";import MagicString from"magic-string";import{namedTypes as t}from"ast-types";import{getNameOrValue,isReactForwardRefCall}from"react-docgen/dist/utils";function actualNameHandler(documentation,path2,importer){if(t.ClassDeclaration.check(path2.node)||t.FunctionDeclaration.check(path2.node))documentation.set("actualName",getNameOrValue(path2.get("id")));else if(t.ArrowFunctionExpression.check(path2.node)||t.FunctionExpression.check(path2.node)||isReactForwardRefCall(path2,importer)){let currentPath=path2;for(;currentPath.parent;){if(t.VariableDeclarator.check(currentPath.parent.node)){documentation.set("actualName",getNameOrValue(currentPath.parent.get("id")));return}if(t.AssignmentExpression.check(currentPath.parent.node)){let leftPath=currentPath.parent.get("left");if(t.Identifier.check(leftPath.node)||t.Literal.check(leftPath.node)){documentation.set("actualName",getNameOrValue(leftPath));return}}currentPath=currentPath.parent}documentation.set("actualName","")}}var defaultHandlers=Object.values(docgenHandlers).map(handler=>handler),defaultResolver=docgenResolver.findAllExportedComponentDefinitions,defaultImporter=docgenImporters.makeFsImporter(),handlers=[...defaultHandlers,actualNameHandler];function reactDocgen({include=/\.(mjs|tsx?|jsx?)$/,exclude=[/node_modules\/.*/]}={}){let cwd=process.cwd(),filter=createFilter(include,exclude);return{name:"storybook:react-docgen-plugin",enforce:"pre",async transform(src,id){let relPath=path.relative(cwd,id);if(filter(relPath))try{let docgenResults=parse(src,defaultResolver,handlers,{importer:defaultImporter,filename:id}),s=new MagicString(src);return docgenResults.forEach(info=>{let{actualName,...docgenInfo}=info;if(actualName){let docNode=JSON.stringify(docgenInfo);s.append(`;${actualName}.__docgenInfo=${docNode}`)}}),{code:s.toString(),map:s.generateMap()}}catch{}}}}export{reactDocgen};
